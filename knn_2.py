# -*- coding: utf-8 -*-
"""knn_2

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1B3_ETmuYqGx1iNCt5CwVqYWiyOuM4boF
"""

import seaborn as sns
import matplotlib.pyplot as plt
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.neighbors  import KNeighborsClassifier
from sklearn.metrics import accuracy_score, confusion_matrix

tips=sns.load_dataset("tips")

tips['smoker_lable']=tips['smoker'].map({'No':0,'Yes':1})
features=["total_bill","tip","size","day","sex"]
X=pd.get_dummies(tips[features])
y=tips["smoker_lable"]

X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.2,random_state=42)

accuracies = []
for k in range(1,11):
  knn=KNeighborsClassifier(n_neighbors=k)
  knn.fit(X_train,y_train)
  y_pred=knn.predict(X_test)
  acc=accuracy_score(y_test,y_pred)
  accuracies.append(acc)
  print(f"K={k} ➡ Accuracy: {acc:.2f}")

plt.plot(range(1,11),accuracies,marker='o')
plt.title("Accuracy of KNN Classifier for Different Values of K")
plt.xlabel("K")
plt.ylabel("Accuracy")
plt.grid(True)
plt.show()

cm = confusion_matrix(y_test, y_pred)
print("Confusion Matrix:\n", cm)

# 9️⃣ رسم Confusion Matrix به صورت تصویری
plt.figure(figsize=(6,4))
sns.heatmap(cm, annot=True, fmt='d', cmap='Blues',
            xticklabels=["No (no smoker)", "Yes (smoker)"],
            yticklabels=["No (no smoker)", "Yes (smoker)"])
plt.xlabel("predicted")
plt.ylabel("real")
plt.title(" Confusion Matrix - KNN for Smoker Prediction")
plt.show()

tree_model = DecisionTreeClassifier(max_depth=4, random_state=42)
tree_model.fit(X_train, y_train)

plt.figure(figsize=(12, 8))
plot_tree(tree_model, feature_names=X.columns, class_names=["No", "Yes"], filled=True)
plt.show()